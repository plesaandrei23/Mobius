FROM node:20-alpine

WORKDIR /app

# Install build tools needed for native modules (like sqlite3)
RUN apk add --no-cache python3 make g++

# Copy only package files first
COPY package*.json ./

# Install dependencies inside the container (Linux build)
RUN npm install

# Now copy the rest of the backend source code (without node_modules)
COPY . .

EXPOSE 8080

CMD ["npm", "start"]